function t(t){return localStorage.getItem(t)}function e(t,e){localStorage.setItem(t,e)}var i=class{reset(){this.todo=[],this.completed=[],this.save()}save(){e("TaskList",JSON.stringify({todo:this.todo,completed:this.completed}))}createTask(t,e){const i={name:t,expected:e,actual:0};this.todo.push(i),this.save()}deleteTask(t){this.todo.splice(t,1),this.save()}updateTask(t,e,i){t>=Object.keys(this.todo).length||(this.todo[t].name=e,this.todo[t].expected=i,this.save())}addPomo(){this.todo[0].actual+=1,this.save()}finishTask(){const t=this.todo[0];this.completed.push(t),this.deleteTask(0)}constructor(){const e=JSON.parse(t("TaskList"));null==e?this.reset():(this.todo=e.todo,this.completed=e.completed)}};class s extends HTMLElement{connectedCallback(){this.connected=!0}addRow(t,e){this.data.createTask(t,Number(e)),this.insertRow(this.data.todo.length,t,e),this.editableTaskList.updateButtonState()}resetEditingState(){this.editingRow=null,this.editingInputs=null,this.originalValues=null}editRow(t,e){this.editingRow&&this.cancelEdit(),this.editingRow=t,this.editingInputs=e,this.originalValues=e.map((t=>t.value)),t.classList.add("edit-mode"),e.forEach((t=>{t.disabled=!1})),e[0].focus(),e[0].setSelectionRange(e[0].value.length,e[0].value.length)}removeRow(t){this.editingRow&&this.cancelEdit(),this.data.deleteTask(Number(t.dataset.id)),t.remove(),Array.from(this.children).forEach(((t,e)=>{t.querySelector("input").value=e+1,t.dataset.id=e})),this.editableTaskList.updateButtonState(),this.nextElementSibling.reset()}saveEdit(){const[t,e]=this.editingInputs.map((t=>t.value));this.data.updateTask(Number(this.editingRow.dataset.id),t,Number(e)),this.originalValues=[t,e],this.cancelEdit()}cancelEdit(){this.editingRow.classList.remove("edit-mode"),this.editingInputs.forEach(((t,e)=>{t.disabled=!0,t.value=this.originalValues[e]})),this.resetEditingState(),this.nextElementSibling.reset()}insertRow(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const s=this.template.cloneNode(!0);this.appendChild(s);const n=this.lastElementChild,o=n.querySelectorAll("input"),a=Array.from(o).slice(-2),[r,d,l,c]=n.querySelectorAll("button"),[h]=e;n.dataset.id=h-1,o.forEach(((t,i)=>{t.value=e[i]})),this.connected&&n.querySelector("tomato-slider").render(),a.forEach((t=>{t.addEventListener("keyup",(t=>{"Enter"!==t.code||l.disabled||this.saveEdit()})),t.addEventListener("input",(()=>{const[t,e]=a;0===t.value.length||Number(e.value)<1?l.disabled=!0:l.disabled=!1}))})),r.addEventListener("click",(()=>{l.disabled=!1,this.editRow(n,a)})),d.addEventListener("click",(()=>{this.removeRow(n)})),l.addEventListener("click",(()=>{this.saveEdit()})),c.addEventListener("click",(()=>{this.cancelEdit()}))}constructor(t){super(),this.editableTaskList=t,this.template=document.querySelector("#task-row-template").content,this.data=new i,this.resetEditingState(),this.data.todo.forEach(((t,e)=>{let{name:i,expected:s}=t;this.insertRow(e+1,i,s)})),this.connected=!1}}customElements.define("editable-task-list-body",s);var n=s;class o extends HTMLElement{connectedCallback(){this.reset()}updateButtonState(){0===this.nameInput.value.length?this.button.disabled=!0:this.button.disabled=!1}addRow(){this.previousElementSibling.addRow(this.nameInput.value,this.expectedInput.value),this.reset()}reset(){this.nameInput.value="",this.expectedInput.value="1",this.nameInput.focus(),this.updateButtonState(),this.resetCount>0&&this.querySelector("tomato-slider").render(),this.resetCount+=1}constructor(){super();const t=document.querySelector("#add-row-template").content.cloneNode(!0);this.appendChild(t),[this.nameInput,this.expectedInput]=this.querySelectorAll("input"),this.button=this.querySelector("button"),[this.nameInput,this.expectedInput].forEach((t=>{t.addEventListener("input",(()=>{this.updateButtonState()}))})),[this.nameInput,this.expectedInput].forEach((t=>{t.addEventListener("keyup",(t=>{"Enter"!==t.code||this.button.disabled||this.addRow()}))})),this.button.addEventListener("click",(()=>{this.addRow()})),this.resetCount=0}}customElements.define("editable-task-list-input",o);var a=o;class r extends HTMLElement{connectedCallback(){this.updateButtonState()}updateButtonState(){this.querySelectorAll(".start-day-button").forEach((t=>{t.disabled=!(this.body.data.todo.length>0)}))}constructor(){super(),this.appendChild(document.querySelector("#edit-title-template").content.cloneNode(!0));const t=document.createElement("div");t.classList.add("task-list-container"),this.appendChild(t),t.appendChild(document.querySelector("#edit-header-row-template").content.cloneNode(!0)),this.body=new n(this),t.appendChild(this.body),t.appendChild(new a)}}customElements.define("editable-task-list",r);var d=r;class l extends HTMLElement{insertTitle(t){const e=document.createElement("h3");e.classList.add("fw-bold","mb-0"),e.textContent=t,this.appendChild(e)}insertHeaderRow(){this.appendChild(this.headerRowTemplate.cloneNode(!0))}insertRow(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const s=this.rowTemplate.cloneNode(!0);this.appendChild(s);this.lastElementChild.querySelectorAll("input").forEach(((t,i)=>{t.value=e[i]}))}constructor(t,e){super(),this.headerRowTemplate=document.querySelector("#view-header-row-template").content,this.rowTemplate=document.querySelector("#view-row-template").content,this.insertTitle(t),this.insertHeaderRow(),e.forEach(((t,e)=>{let{name:i,expected:s,actual:n}=t;this.insertRow(e+1,i,s,n)}))}}customElements.define("view-only-task-list-section",l);var c=l;class h extends HTMLElement{connectedCallback(){this.position()}render(){for(;this.taskListContainer.firstChild;)this.taskListContainer.removeChild(this.taskListContainer.firstChild);this.taskListContainer.appendChild(new c("To Do",this.data.todo)),this.data.completed.length>0&&this.taskListContainer.appendChild(new c("Completed",this.data.completed))}position(){this.visible?(this.taskListTitle.innerHTML='<i class="fas fa-chevron-down"></i>',this.style.top="".concat(this.appHeader.offsetHeight,"px")):(this.taskListTitle.innerHTML='<i class="fas fa-chevron-up"></i>',this.style.top="".concat(this.appContainer.offsetHeight-(this.querySelector(".task-list-container").getBoundingClientRect().top-this.getBoundingClientRect().top),"px"))}addPomo(){this.data.addPomo(),this.render()}finishTask(){this.data.finishTask(),this.render()}constructor(){super(),this.data=new i,this.appContainer=document.querySelector(".app-container"),this.appHeader=document.querySelector(".app-header"),this.visible=!1,this.taskListTitle=document.createElement("h2"),this.taskListTitle.classList.add("subtitle","text-center","mt-2","mb-2"),this.taskListContainer=document.createElement("div"),this.taskListContainer.classList.add("task-list-container"),this.appendChild(this.taskListTitle),this.appendChild(this.taskListContainer),this.taskListTitle.addEventListener("click",(()=>{this.visible=!this.visible,this.position()})),window.addEventListener("resize",(()=>{this.position()})),this.render()}}customElements.define("view-only-task-list",h);var u=h;var m=class{startTimer(){return new Promise((t=>{const e="Timer Finished";null!==this.callbackEverySecond&&this.callbackEverySecond(this.minutes,this.seconds),0===this.seconds&&0!==this.minutes?(this.minutes-=1,this.seconds=60):0===this.seconds&&0===this.minutes&&t(e),this.seconds-=1;const i=setInterval((()=>{null!==this.callbackEverySecond&&this.callbackEverySecond(this.minutes,this.seconds),0===this.seconds&&0!==this.minutes?(this.minutes-=1,this.seconds=60):0===this.seconds&&0===this.minutes&&(t(e),clearInterval(i)),this.seconds-=1}),1e3)}))}constructor(t,e,i){t>99&&(t=99),this.minutes=t,e>59&&(e=59),this.seconds=e,this.callbackEverySecond=i}};class p extends HTMLElement{reset(){this.text.textContent="START",this.classList.remove("timer-active")}clear(){this.text.textContent="All Done!"}createTimer(t,e){this.timer=new m(t,e,((t,e)=>{this.text.textContent="".concat(p.parseMinutes(t)," : ").concat(p.parseSeconds(e))}))}startTimer(){return this.text.textContent="".concat(p.parseMinutes(this.timer.minutes)," : ").concat(p.parseSeconds(this.timer.seconds)),this.classList.add("timer-active"),this.timer.startTimer()}static parseMinutes(t){return t<10?"0".concat(String(t)):String(t)}static parseSeconds(t){return 60===t||t>=60?"00":t<10?"0".concat(String(t)):String(t)}setColorGreen(){this.querySelector(".timer-image").classList.remove("red-tomato"),this.querySelector(".timer-image").classList.add("green-tomato")}setColorRed(){this.querySelector(".timer-image").classList.remove("green-tomato"),this.querySelector(".timer-image").classList.add("red-tomato")}setColorGold(){this.querySelector(".timer-image").classList.add("gold-tomato")}constructor(){super(),this.classList.add("w-100","h-100","d-flex","flex-column","justify-content-center","align-items-center"),this.appendChild(document.querySelector("#timer-template").content.cloneNode(!0)),this.text=this.querySelector(".timer-text")}}customElements.define("pomo-timer",p);var f=p;class v extends HTMLElement{getChecked(){return this.checked}constructor(e){super(),this.checked=!1;const i=JSON.parse(t("TaskList")),s=document.createElement("button");s.classList.add("btn","btn-success","btn-lg"),s.textContent=i&&i.todo.length>1?"Finished Current Task":"Finished Final Task, End Session",this.appendChild(s),s.addEventListener("click",(()=>{this.checked=!0,s.remove(),e.bind(this,this)()}))}}customElements.define("break-prompt",v);var k=v;class S{static show(){document.querySelector("#notification").style.display="flex"}static hide(){document.querySelector("#notification").style.display="none"}static prompt(t,e){let{title:i,subtitle:s,leftButton:n,rightButton:o}=t;return document.querySelector("#notification-title").textContent=i||"",document.querySelector("#notification-subtitle").textContent=s||"",document.querySelector("#notif-left").textContent=n||"",document.querySelector("#notif-right").textContent=o||"",S.show(),new Promise((t=>{document.querySelector("#notification").onclick=i=>{i.target.querySelector("#notif-content")&&e&&(S.hide(),t("neither"))},document.querySelector("#notif-left").onclick=()=>{t("left")},document.querySelector("#notif-right").onclick=()=>{t("right")}}))}}var g=S;const w=document.querySelector(".app-container");let E=!1;function T(){let i=JSON.parse(t("History"));const{completed:s}=JSON.parse(t("TaskList"));i?i.tasklists.push(s):i={tasklists:[s]},e("History",JSON.stringify(i)),localStorage.removeItem("TaskList"),localStorage.removeItem("Started"),localStorage.removeItem("TotalPomos"),localStorage.removeItem("Timer");g.prompt({title:"Congratulations, you have finished this session!",subtitle:"What would you like to do next?",leftButton:"Start New Session",rightButton:"View Logs"},!1).then((t=>{"left"===t?window.location.href="./index.html":"right"===t&&(window.location.href="./done.html")}))}function y(e){const s=JSON.parse(t("TaskList")),{length:n}=s.todo;let o="";if(0===n){o="End of Session",E=!0;(new i).finishTask(),T()}else if(e&&1===n){o="End of Session",E=!0;(new i).finishTask(),T()}else o=e&&n-1==1?"Final Task: ".concat(s.todo[1].name):e&&n-1>1?"Next Task: ".concat(s.todo[1].name):1===n?"Final Task: ".concat(s.todo[0].name):"Current Task: ".concat(s.todo[0].name);document.querySelector(".app-title").textContent=o}function C(t){y(t.getChecked())}function b(e){if(0===JSON.parse(t("TaskList")).todo.length)T();else{const i=t("Timer");if(e.reset(),"true"===i)y(!1),e.setColorGreen(),e.createTimer(25,0);else{const i=Number(t("TotalPomos")),s=new k(C);y(!1),e.setColorRed(),e.appendChild(s),i>0&&i%4==0?e.createTimer(25,0):e.createTimer(5,0)}}}function L(i,s){let n=!1;i.firstElementChild.addEventListener("click",(()=>{n||(n=!0,i.startTimer().then((()=>{if(!E){const o=t("Timer");"true"===o&&(e("TotalPomos",Number(t("TotalPomos"))+1),s.addPomo()),"false"===o&&(i.lastElementChild.getChecked()&&(s.finishTask(),s.render()),i.lastElementChild.remove()),"Notification"in window&&"granted"===Notification.permission&&function(){if("true"===t("Timer")){const t=new Notification("Electric Pomato",{icon:"img/green-tomato.ico",body:"Good Work! Time to recharge."});setTimeout(t.close.bind(t),5e3),t.addEventListener("click",(()=>{window.focus()}))}else{const t=new Notification("Electric Pomato",{icon:"img/red-tomato.ico",body:"Break time is over. It's time to plug in!"});setTimeout(t.close.bind(t),5e3),t.addEventListener("click",(()=>{window.focus()}))}}(),e("Timer","false"===o),b(i),n=!1}})))}))}function x(){const t=new f,e=new u;y(!1),L(t,e),b(t),w.appendChild(t),w.appendChild(e)}window.addEventListener("load",(function(){t("Username")?t("Started")?x():(w.appendChild(new d),document.querySelector(".app-title").textContent="".concat(t("Username"),"'s Day"),w.querySelectorAll(".start-day-button").forEach((t=>{t.addEventListener("click",(()=>{e("Started",!0),e("Timer",!0),e("TotalPomos",0),w.lastElementChild.remove(),x()}))}))):window.location.href="index.html","Notification"in window?(console.log(Notification.permission),"denied"!==Notification.permission&&Notification.requestPermission()):console.log("This browser does not support notifications.")}));