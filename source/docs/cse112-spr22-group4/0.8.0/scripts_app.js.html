<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>scripts/app.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CurrentYear.html">CurrentYear</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="EditableTaskList.html">EditableTaskList</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EditableTaskList.html#connectedCallback">connectedCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EditableTaskList.html#updateButtonState">updateButtonState</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="EditableTaskListBody.html">EditableTaskListBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EditableTaskListBody.html#addRow">addRow</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EditableTaskListBody.html#cancelEdit">cancelEdit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EditableTaskListBody.html#editRow">editRow</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EditableTaskListBody.html#insertRow">insertRow</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EditableTaskListBody.html#removeRow">removeRow</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EditableTaskListBody.html#resetEditingState">resetEditingState</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EditableTaskListBody.html#saveEdit">saveEdit</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="EditableTaskListInput.html">EditableTaskListInput</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EditableTaskListInput.html#addRow">addRow</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EditableTaskListInput.html#connectedCallback">connectedCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EditableTaskListInput.html#reset">reset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EditableTaskListInput.html#updateButtonState">updateButtonState</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="FinishTaskButton.html">FinishTaskButton</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FinishTaskButton.html#getChecked">getChecked</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FinishTaskButton.html#updateButton">updateButton</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="InfoModal.html">InfoModal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="InfoModal.html#close">close</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="IntroIcons.html">IntroIcons</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="MenuIcons.html">MenuIcons</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MenuIcons.html#createHomeButton">createHomeButton</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MenuIcons.html#createIcons">createIcons</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MenuIcons.html#createInfoButton">createInfoButton</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MenuIcons.html#createSettingsButton">createSettingsButton</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MenuIcons.html#createStatsButton">createStatsButton</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MenuIcons.html#defaultMode">defaultMode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MenuIcons.html#focusMode">focusMode</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="PopUp.html">PopUp</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PopUp.html#.show">show</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RemainingPomos.html">RemainingPomos</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RemainingPomos.html#hiddenMode">hiddenMode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RemainingPomos.html#resetPomos">resetPomos</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RemainingPomos.html#setPomos">setPomos</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RemainingPomos.html#updateCompletedPomos">updateCompletedPomos</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RemainingPomos.html#visibleMode">visibleMode</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="SettingsModal.html">SettingsModal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SettingsModal.html#.setDefaultValuesInStorage">setDefaultValuesInStorage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SettingsModal.html#close">close</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SettingsModal.html#loadStoredInputValues">loadStoredInputValues</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SettingsModal.html#open">open</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SettingsModal.html#revertToDefault">revertToDefault</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SettingsModal.html#saveSettings">saveSettings</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="StartButtons.html">StartButtons</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StartButtons.html#.createAnchor">createAnchor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StartButtons.html#.createButton">createButton</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="StartContainer.html">StartContainer</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="StatsModal.html">StatsModal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StatsModal.html#loadLineChart">loadLineChart</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StatsModal.html#open">open</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TaskList.html">TaskList</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TaskList.html#addPomo">addPomo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TaskList.html#createTask">createTask</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TaskList.html#deleteTask">deleteTask</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TaskList.html#finishTask">finishTask</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TaskList.html#reset">reset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TaskList.html#save">save</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TaskList.html#startTask">startTask</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TaskList.html#updateTask">updateTask</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TaskList.html#updateTime">updateTime</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Timer.html">Timer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Timer.html#startTimer">startTimer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Timer.html#timer">timer</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TimerUI.html">TimerUI</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TimerUI.html#.parseMinutes">parseMinutes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TimerUI.html#.parseSeconds">parseSeconds</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TimerUI.html#attributeChangedCallback">attributeChangedCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TimerUI.html#connectedCallback">connectedCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TimerUI.html#createTimer">createTimer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TimerUI.html#reset">reset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TimerUI.html#setBreakIcon">setBreakIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TimerUI.html#setPomoIcon">setPomoIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TimerUI.html#startTimer">startTimer</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TomatoSlider.html">TomatoSlider</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TomatoSlider.html#colorTomatos">colorTomatos</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TomatoSlider.html#connectedCallback">connectedCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TomatoSlider.html#defaultMode">defaultMode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TomatoSlider.html#editMode">editMode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TomatoSlider.html#handleClick">handleClick</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TomatoSlider.html#handleKeyDown">handleKeyDown</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TomatoSlider.html#handleKeyUp">handleKeyUp</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TomatoSlider.html#handleMouseLeave">handleMouseLeave</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TomatoSlider.html#handleMouseMove">handleMouseMove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TomatoSlider.html#render">render</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TomatoSlider.html#updateState">updateState</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="UsernameInput.html">UsernameInput</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ViewOnlyTaskList.html">ViewOnlyTaskList</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViewOnlyTaskList.html#addPomo">addPomo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViewOnlyTaskList.html#connectedCallback">connectedCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViewOnlyTaskList.html#finishTask">finishTask</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViewOnlyTaskList.html#position">position</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViewOnlyTaskList.html#render">render</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViewOnlyTaskList.html#startTask">startTask</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViewOnlyTaskList.html#updateTime">updateTime</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ViewOnlyTaskListSection.html">ViewOnlyTaskListSection</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViewOnlyTaskListSection.html#insertHeaderRow">insertHeaderRow</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViewOnlyTaskListSection.html#insertRow">insertRow</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViewOnlyTaskListSection.html#insertTitle">insertTitle</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="WelcomeMessage.html">WelcomeMessage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="WelcomeMessage.html#createCancelEditButton">createCancelEditButton</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="WelcomeMessage.html#createEditNameButton">createEditNameButton</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="WelcomeMessage.html#createFinishEditButton">createFinishEditButton</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="WelcomeMessage.html#enterDefaultMode">enterDefaultMode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="WelcomeMessage.html#enterEditMode">enterEditMode</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#appContainer">appContainer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#clearSessionData">clearSessionData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#handleTick">handleTick</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isLongBreak">isLongBreak</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#removeAll">removeAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#set">set</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">scripts/app.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file The main controller of the HTML and interaction between Front-End and Back-End.
 * @author Andy Young
 * @author Donald Wolfson
 * @author Justin Lee
 * @author Enrique Gan
 * @author Teresa Truong
 * @author Annika Hatcher
 * @author Luke Menezes
 * @author Meshach Adoe
 * @author Xingyu Zhu
 * @author Alan Wang
 * @author Steven Harris
 */

import PopUp from '../classes/PopUp.js';
import EditableTaskList from '../components/EditableTaskList.js';
import ViewOnlyTaskList from '../components/ViewOnlyTaskList.js';
import TimerUI from '../components/TimerUI.js';
import RemainingPomos from '../components/RemainingPomos.js';
import FinishTaskButton from '../components/FinishTaskButton.js';
import StatsModal from '../components/StatsModal.js';
import * as backend from '../backend.js';

// Icon assets
import pomoIcon from '../../assets/images/green-tomato.webp';
import breakIcon from '../../assets/images/red-tomato.webp';

const appIcon = new URL('../../assets/images/favicon.ico', import.meta.url);

// Import audio from local file
const notiSound = new URL('../../assets/audio/notification-ping.mp3', import.meta.url);

/**
 * STATE:
 * {
 *  Username: {String}
 *    null: redirect to index.html
 *  Started: {Boolean}
 *    true: display TimerUI &amp; ViewOnlyTaskList,
 *    false: go to Editable Task List display.
 *  TotalPomos: {Number}
 *    Elapsed pomos.
 *  Timer: {Boolean}
 *    true: pomodoro
 *    false: break
 *      TotalPomos % 4 == 0: long break
 *      else: short break
 * }
 */

// DOM elements
const appContainer = document.querySelector('.app-container');
const favicon = document.querySelector("link[rel*='icon']");

// Menu icons
const menuIcons = document.querySelector('menu-icons');

// Finished state
let finished = false;

// Timer UI
let timerUI = null;

// Remaining Pomos
let remainingPomos = null;

// View only task list
let votl = null;

// Website title
let windowTitle = 'Electric Pomato';

/* **************************** Helper Functions **************************** */

/**
 * Returns whether or not the next break is a short or long break
 * @return {boolean} true if next break is a long break, false otherwise
 */
function isLongBreak() {
  const currentPomos = Number(backend.get('CurrentPomos'));
  // If there has been 4 pomos then it is a long break
  return currentPomos > 0 &amp;&amp; currentPomos % 4 === 0;
}

/**
 * Handles all things that need to be done on timer tick, like updating website title
 */
function handleTick(event) {
  document.title = `${event.text} - ${windowTitle}`;
}
/**
 * Handles all things that need to be done at the end of the session, called by initTimer
 * @ignore
 */
function handleEndOfSession() {
  // Move completed task list to history
  let history = JSON.parse(backend.get('History'));
  const { completed } = JSON.parse(backend.get('TaskList'));
  const currDate = new Date();

  // Store tasklist as session with date of completion
  const session = {
    date: `${currDate.getMonth() + 1}/${currDate.getDate()}/${currDate.getFullYear()}`,
    tasklist: completed,
  };

  if (history) {
    history.sessions.push(session);
  } else {
    history = { sessions: [session] };
  }
  backend.set('History', JSON.stringify(history));

  // Wipe data from previous task list
  backend.clearSessionData();

  // if user does not have enough sessions, go to homepage, otherwise open stats modal
  const statsModal = document.querySelector('stats-modal');
  if (!StatsModal.hasEnoughSessions()) {
    window.location.href = './index.html';
  } else {
    statsModal.open('./index.html');
  }
}

/**
 * Update the .app-title based on the break's checkbox.
 * @param {boolean} taskFinished - true if moving on to next task in list, false otherwise.
 * @ignore
 */
function updateAppTitle(taskFinished) {
  const taskList = JSON.parse(backend.get('TaskList'));
  const { length } = taskList.todo;
  const appTitle = document.querySelector('.app-title');
  const appSubtitle = document.querySelector('.app-subtitle');

  let subtitle = '';

  // Set title based on timer state
  if (backend.get('Timer') === 'true' &amp;&amp; !taskFinished) {
    appTitle.textContent = 'Pomodoro';
  } else if (isLongBreak()) {
    appTitle.textContent = 'Long Break';
  } else {
    appTitle.textContent = 'Short Break';
  }

  // Determine the subtitle based on the length of the TODO list.
  if (length === 0) {
    subtitle = 'End of Session';
    finished = true;
    handleEndOfSession();
  } else if (backend.get('Timer') === 'true') {
    if (taskFinished) {
      appTitle.textContent = `Focus: ${taskList.todo[0].name}`;
    } else {
      subtitle = `Focus: ${taskList.todo[0].name}`;
    }
  } else if (taskFinished &amp;&amp; length > 1) {
    subtitle = `Next Task: ${taskList.todo[0].name}`;
  } else if (length === 1) {
    subtitle = `Final Task: ${taskList.todo[0].name}`;
  } else {
    subtitle = `Current Task: ${taskList.todo[0].name}`;
  }
  appSubtitle.textContent = subtitle;
}

/**
 * A callback function used in the FinishTaskButton on
 * changing of the timer and the text on thebutton.
 * @param {Object} object - A FinishTaskButton object.
 * @ignore
 */
function nextTask(object) {
  // Add any partial time from a pomo session to the task time.
  // Check that the timer is running for the edge case where a task
  // is finished during break, but timer has updated to pomo.
  const svgDoc = document.querySelector('#timerIcon').contentDocument;
  votl.finishTask(backend.get('Timer') === 'true' &amp;&amp; svgDoc.querySelector('.timer-text').textContent !== 'START');

  if (votl.data.todo.length > 0) remainingPomos.setPomos(votl.data);

  // Update app title
  updateAppTitle(object.getChecked());

  // Update Finish task button according to task list
  object.updateButton();

  // Start tracking time for the next task
  votl.startTask();
}

/**
 * @ignore
 * Initialize the timer based on current STATE.
 * @ignore
 * @param {Object} timer - The Timer object.
 * @ignore
 */
function initTimer(timer) {
  // Change to done page if no more tasks in todo.
  if (JSON.parse(backend.get('TaskList')).todo.length === 0) {
    handleEndOfSession();
  } else {
    const timerState = backend.get('Timer');
    timer.reset();

    // If timer is true set pomo, otherwise it is a break
    if (timerState === 'true') {
      // Update the HTML
      updateAppTitle(false);
      timer.setPomoIcon();
    } else {
      // Update the HTML
      menuIcons.defaultMode();
      document.querySelector('.app-subtitle').style.display = 'block';
      updateAppTitle(false);
      timer.setBreakIcon();
    }
  }
}

/**
 * Plays the sound from the given link
 * @param {String} link - Link to mp3 file to play
 * @ignore
 */
function playSound(link) {
  const sound = new Audio(link);
  sound.play();
}

/**
 * Displays notification and plays sound when timer ends
 * @ignore
 */
function showTimerNotification() {
  const timerState = backend.get('Timer');
  const audioToggle = backend.get('AudioToggle');
  const pomoAlert = {
    icon: null,
    body: null,
    tag: 'pomo-alert',
    silent: true,
  };

  // Set notification icon/text based on timer state
  if (timerState === 'true') {
    pomoAlert.icon = pomoIcon;
    pomoAlert.body = 'Good Work! Time to recharge.';
  } else {
    pomoAlert.icon = breakIcon;
    pomoAlert.body = "Break time is over. It's time to plug in!";
  }

  // Show the notification
  let register = null;
  navigator.serviceWorker.getRegistration()
    .then((reg) => {
      register = reg;
      reg.showNotification('Electric Pomato', pomoAlert)
        .then(() => register.getNotifications()
          .then((notifications) => {
            setTimeout(() => notifications.forEach((notification) => notification.close()), 5000);
          }));
      if (audioToggle === 'on') {
        playSound(notiSound);
      }
    });
}

/**
 * Handle starting the timer and updating the Pomos.
 * @param {Object} timer - The Timer object.
 * @param {Object} taskList - The TaskList object.
 * @ignore
 */
function handleClick(timer, taskList) {
  let active = false;

  timer.addEventListener('iconclick', () => {
    if (!active) {
      document.addEventListener('timerTick', handleTick);
      if (backend.get('Timer') === 'true') {
        favicon.href = pomoIcon;
        windowTitle = 'Plugged in!';
        // Hide all icons except home when a work session starts.
        menuIcons.focusMode();
        taskList.startTask();
        // Replace the title with the subtitle and hide the subtitle
        const appTitle = document.querySelector('.app-title');
        const appSubtitle = document.querySelector('.app-subtitle');
        appTitle.textContent = appSubtitle.textContent;
        appSubtitle.style.display = 'none';
        const workSessionDuration = backend.get('WorkSessionDuration');
        timer.createTimer(workSessionDuration, 0);
      } else {
        favicon.href = breakIcon;
        windowTitle = 'Recharging...';
        if (isLongBreak()) {
          const longBreakDuration = backend.get('LongBreakDuration');
          timer.createTimer(longBreakDuration, 0);
        } else {
          const shortBreakDuration = backend.get('ShortBreakDuration');
          timer.createTimer(shortBreakDuration, 0);
        }
      }

      remainingPomos.hiddenMode();

      // Create finish task button for this session
      const finishTaskButton = new FinishTaskButton(nextTask);
      remainingPomos.insertAdjacentElement('beforebegin', finishTaskButton);

      active = true;
      timer.startTimer().then(() => {
        if (!finished) {
          // Reset to default icon/title
          document.removeEventListener('timerTick', handleTick);
          favicon.href = appIcon;
          windowTitle = 'Electric Pomato';
          document.title = windowTitle;

          const timerState = backend.get('Timer');

          // Increment pomos if we were in a Pomo session
          if (timerState === 'true') {
            backend.set('TotalPomos', Number(backend.get('TotalPomos')) + 1);
            backend.set('CurrentPomos', Number(backend.get('CurrentPomos')) + 1);
            taskList.updateTime();
            remainingPomos.updateCompletedPomos(taskList.data);

            // Alert the user if they have reached their expected number of pomos
            const endMessage = {
              title: 'You have completed the planned Pomodoros for this task. Finish task or continue working?',
              leftButton: 'Finish Task',
              rightButton: 'Continue Working',
            };
            if (taskList.data.todo[0].actual === taskList.data.todo[0].expected) {
              PopUp.prompt(endMessage, false).then((result) => {
                if (result === 'left') {
                  // Simulate clicking the finish task button
                  finishTaskButton.checked = true;
                  nextTask(finishTaskButton);
                  PopUp.hide();
                } else {
                  PopUp.hide();
                }
              });
            }
          }

          // Remove the finish task button
          timer.querySelector('finish-task-button').remove();

          if (('Notification' in window) &amp;&amp; navigator.serviceWorker &amp;&amp; Notification.permission === 'granted') {
            showTimerNotification();
          }

          backend.set('Timer', timerState === 'false');
          remainingPomos.visibleMode();

          initTimer(timer);
          active = false;
        }
      });
    }
  });
}

/**
 * Displays the Timer and begins to handle the events of interaction.
 * @ignore
 */
function showTimer() {
  timerUI = new TimerUI();
  votl = new ViewOnlyTaskList();
  remainingPomos = new RemainingPomos();

  timerUI.appendChild(remainingPomos);

  // Call any helper functions to handle user events.
  handleClick(timerUI, votl);
  initTimer(timerUI);

  appContainer.appendChild(timerUI);
  appContainer.appendChild(votl);
}

/* ***************************** Event Handling ***************************** */

/**
 * Will hold all Edge Cases that should be check when a page is loaded.
 * @ignore
 */
function handleOnLoad() {
  // Redirect to index.html if no name is in localStorage.
  if (backend.get('Username') == null) {
    window.location.href = 'index.html';
  } else if (backend.get('Started') === 'true') {
    // if started session, go to timer
    showTimer();
  } else {
    // otherwise, go to task list page
    if (backend.get('HasSeenInfo') === null) {
      menuIcons.infoModal.open();
      backend.set('HasSeenInfo', 'true');
    }
    appContainer.appendChild(new EditableTaskList());
    document.querySelector('.app-title').textContent = `${backend.get('Username')}'s Session`;
    appContainer.querySelectorAll('.start-day-button').forEach((button) => {
      button.addEventListener('click', () => {
        backend.set('Started', true);
        backend.set('Timer', true);
        backend.set('TotalPomos', 0);
        backend.set('CurrentPomos', 0);
        appContainer.lastElementChild.remove();
        showTimer();
      });
    });
  }

  // Request notification permission on page load
  if (!('Notification' in window)) {
    console.log('Error: Browser does not support notifications');
  } else if (Notification.permission === 'granted') {
    console.log(`Notifications permission ${Notification.permission}`);
  } else if (Notification.permission !== 'denied') {
    Notification.requestPermission((permission) => {
      if (!('permission' in Notification)) {
        Notification.permission = permission;
      }
      if (permission === 'granted') {
        console.log('Notifications permission granted');
      }
    });
  } else {
    console.log(`Notifications permission ${Notification.permission}`);
  }
}

// Handle any edge cases on loading into the page.
window.addEventListener('load', handleOnLoad);
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.10</a> on Mon Jun 06 2022 08:53:12 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
